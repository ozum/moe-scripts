{"version":3,"sources":["../../src/config/rollup.config.js"],"names":["path","require","camelcase","rollupBabel","commonjs","nodeResolve","json","replace","uglify","nodeBuiltIns","nodeGlobals","omit","pkg","hasFile","hasPkgProp","parseEnv","ifFile","here","join","__dirname","p","capitalize","s","toUpperCase","slice","minify","format","process","env","BUILD_FORMAT","isPreact","isNode","name","BUILD_NAME","defaultGlobals","Object","keys","peerDependencies","reduce","deps","dep","defaultExternal","input","BUILD_INPUT","filenameSuffix","BUILD_FILENAME_SUFFIX","filenamePrefix","BUILD_FILENAME_PREFIX","globals","assign","preact","external","concat","filter","e","i","arry","indexOf","react","splice","externalPattern","RegExp","externalPredicate","length","test","id","esm","umd","filename","Boolean","filepath","output","file","exports","useBuiltinConfig","babelPresets","replacements","entries","acc","key","value","val","Number","isInteger","JSON","stringify","module","plugins","preferBuiltins","jsnext","main","include","exclude","presets","babelrc"],"mappings":"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","file":"rollup.config.js","sourcesContent":["const path = require('path')\nconst camelcase = require('lodash.camelcase')\nconst rollupBabel = require('rollup-plugin-babel')\nconst commonjs = require('rollup-plugin-commonjs')\nconst nodeResolve = require('rollup-plugin-node-resolve')\nconst json = require('rollup-plugin-json')\nconst replace = require('rollup-plugin-replace')\nconst uglify = require('rollup-plugin-uglify')\nconst nodeBuiltIns = require('rollup-plugin-node-builtins')\nconst nodeGlobals = require('rollup-plugin-node-globals')\nconst omit = require('lodash.omit')\nconst {pkg, hasFile, hasPkgProp, parseEnv, ifFile} = require('../utils')\n\nconst here = p => path.join(__dirname, p)\nconst capitalize = s => s[0].toUpperCase() + s.slice(1)\n\nconst minify = parseEnv('BUILD_MINIFY', false)\nconst format = process.env.BUILD_FORMAT\nconst isPreact = parseEnv('BUILD_PREACT', false)\nconst isNode = parseEnv('BUILD_NODE', false)\nconst name = process.env.BUILD_NAME || capitalize(camelcase(pkg.name))\n\nconst defaultGlobals = Object.keys(pkg.peerDependencies || {}).reduce(\n  (deps, dep) => {\n    deps[dep] = capitalize(camelcase(dep))\n    return deps\n  },\n  {},\n)\n\nconst defaultExternal = Object.keys(pkg.peerDependencies || {})\n\nconst input =\n  process.env.BUILD_INPUT ||\n  ifFile(`src/${format}-entry.js`, `src/${format}-entry.js`, 'src/index.js')\n\nconst filenameSuffix = process.env.BUILD_FILENAME_SUFFIX || ''\nconst filenamePrefix =\n  process.env.BUILD_FILENAME_PREFIX || (isPreact ? 'preact/' : '')\nconst globals = parseEnv(\n  'BUILD_GLOBALS',\n  isPreact ? Object.assign(defaultGlobals, {preact: 'preact'}) : defaultGlobals,\n)\nconst external = parseEnv(\n  'BUILD_EXTERNAL',\n  isPreact ? defaultExternal.concat(['preact', 'prop-types']) : defaultExternal,\n).filter((e, i, arry) => arry.indexOf(e) === i)\n\nif (isPreact) {\n  delete globals.react\n  delete globals['prop-types'] // TODO: is this necessary?\n  external.splice(external.indexOf('react'), 1)\n}\n\nconst externalPattern = new RegExp(`^(${external.join('|')})($|/)`)\nconst externalPredicate =\n  external.length === 0 ? () => false : id => externalPattern.test(id)\n\nconst esm = format === 'esm'\nconst umd = format === 'umd'\n\nconst filename = [\n  pkg.name,\n  filenameSuffix,\n  `.${format}`,\n  minify ? '.min' : null,\n  '.js',\n]\n  .filter(Boolean)\n  .join('')\n\nconst filepath = path.join(\n  ...[filenamePrefix, 'dist', filename].filter(Boolean),\n)\n\nconst output = [\n  {\n    name,\n    file: filepath,\n    format: esm ? 'es' : format,\n    exports: esm ? 'named' : 'default',\n    globals,\n  },\n]\n\nconst useBuiltinConfig = !hasFile('.babelrc') && !hasPkgProp('babel')\nconst babelPresets = useBuiltinConfig ? [here('../config/babelrc.js')] : []\n\nconst replacements = Object.entries(\n  umd ? process.env : omit(process.env, ['NODE_ENV']),\n).reduce((acc, [key, value]) => {\n  let val\n  if (value === 'true' || value === 'false' || Number.isInteger(+value)) {\n    val = value\n  } else {\n    val = JSON.stringify(value)\n  }\n  acc[`process.env.${key}`] = val\n  return acc\n}, {})\n\nmodule.exports = {\n  input,\n  output,\n  external: externalPredicate,\n  plugins: [\n    isNode ? nodeBuiltIns() : null,\n    isNode ? nodeGlobals() : null,\n    nodeResolve({preferBuiltins: isNode, jsnext: true, main: true}),\n    commonjs({include: 'node_modules/**'}),\n    json(),\n    rollupBabel({\n      exclude: 'node_modules/**',\n      presets: babelPresets,\n      babelrc: true,\n    }),\n    replace(replacements),\n    minify ? uglify() : null,\n  ].filter(Boolean),\n}\n"]}